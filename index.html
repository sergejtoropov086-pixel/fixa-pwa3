<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Fixa Pro ‚Äî –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
  <meta name="description" content="–ü–æ–ª–Ω—ã–π offline-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–µ –∏ –∑–¥–æ—Ä–æ–≤—å—é. 10 000+ –∑–∞–ø—á–∞—Å—Ç–µ–π. –ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ë–µ–∑ –æ–±–ª–∞–∫–∞.">
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png" />
  <meta name="theme-color" content="#1a73e8" />
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
  <style id="theme-styles">
    :root {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-secondary: #64748b;
      --btn-bg: #1d4ed8;
      --btn-hover: #1e40af;
      --danger: #ef4444;
      --success: #10b981;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --border: #e2e8f0;
    }
    .dark-mode {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --text: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: #334155;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 16px; max-width: 800px; margin: 0 auto; }
    header { text-align: center; margin: 20px 0; position: relative; }
    h1 { font-size: 28px; color: var(--btn-bg); margin: 10px 0; }
    #status { font-size: 16px; color: var(--text-secondary); margin-top: 8px; }
    #search { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 10px; background: var(--card-bg); color: var(--text); }
    .tab { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .tab-btn { flex: 1; min-width: 120px; padding: 10px; background: var(--border); color: var(--text); border: none; border-radius: 8px; }
    .tab-btn.active { background: var(--btn-bg); color: white; }
    .card, .db-item { background: var(--card-bg); padding: 16px; border-radius: 14px; margin-bottom: 16px; box-shadow: var(--shadow); border: 1px solid var(--border); }
    .hidden { display: none; }
    .loader { text-align: center; margin: 20px 0; color: var(--btn-bg); }
    .status-in_stock { color: var(--success); }
    .status-expected { color: #f59e0b; }
    .status-purchased { color: #6b7280; }
  </style>
</head>
<body>
  <header>
    <h1>Fixa Pro</h1>
    <p id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...</p>
  </header>

  <div class="tab">
    <button class="tab-btn active" data-tab="models">üìã –ú–æ–¥–µ–ª–∏ —Ç–µ—Ö–Ω–∏–∫–∏</button>
    <button class="tab-btn" data-tab="spare-parts">üîß –ó–∞–ø—á–∞—Å—Ç–∏</button>
    <button class="tab-btn" data-tab="health">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</button>
  </div>

  <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–æ–¥–µ–ª—è–º, –∞—Ä—Ç–∏–∫—É–ª–∞–º, –∑–∞–ø—á–∞—Å—Ç—è–º...">
  
  <div id="models-tab">
    <div class="loader" id="models-loader">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</div>
    <div id="models-list" class="hidden"></div>
  </div>

  <div id="spare-parts-tab" class="hidden">
    <div class="loader" id="spare-loader">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—á–∞—Å—Ç–µ–π...</div>
    <div id="spare-list" class="hidden"></div>
  </div>

  <div id="health-tab" class="hidden">
    <h3>–°–∏–º–ø—Ç–æ–º—ã</h3>
    <div id="symptom-list"></div>
    <h3>–ü—Ä–µ–ø–∞—Ä–∞—Ç—ã</h3>
    <div id="medicine-list"></div>
  </div>

  <script>
    // === –•–†–ê–ù–ï–ù–ò–ï ===
    const Storage = {
      load(type) {
        try {
          const data = localStorage.getItem(`fixa_${type}`);
          return data ? JSON.parse(data) : [];
        } catch (e) {
          return [];
        }
      }
    };

    // === UI ===
    const UI = {
      escape(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '<', '>': '>', '"': '&quot;', "'": '&#039;' }[m]));
      },

      renderModels(filter = '') {
        const list = document.getElementById('models-list');
        if (!window.FixaDB || !FixaDB.models) {
          list.innerHTML = '<div class="card">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>';
          return;
        }
        
        const items = filter ? FixaDB.models.filter(m => 
          m.model.toLowerCase().includes(filter) ||
          m.brand.toLowerCase().includes(filter) ||
          m.type.toLowerCase().includes(filter)
        ) : FixaDB.models;
        
        list.innerHTML = items.slice(0, 200).map(m => `
          <div class="db-item">
            <strong>${m.brand} ${m.model}</strong><br>
            –¢–∏–ø: ${m.type}<br>
            –ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞: ${m.years}
          </div>
        `).join('');
        list.classList.remove('hidden');
        document.getElementById('models-loader').classList.add('hidden');
      },

      renderSpareParts(filter = '') {
        const list = document.getElementById('spare-list');
        if (!window.FixaDB || !FixaDB.spareParts) {
          list.innerHTML = '<div class="card">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>';
          return;
        }
        
        const items = filter ? FixaDB.spareParts.filter(p => 
          p.name.toLowerCase().includes(filter) ||
          p.partNumber.toLowerCase().includes(filter) ||
          p.brand.toLowerCase().includes(filter) ||
          p.model.toLowerCase().includes(filter)
        ) : FixaDB.spareParts;
        
        list.innerHTML = items.slice(0, 200).map(p => `
          <div class="db-item">
            <strong>${p.name}</strong><br>
            –ê—Ä—Ç–∏–∫—É–ª: ${p.partNumber}<br>
            –ú–æ–¥–µ–ª—å: ${p.model}<br>
            –ë—Ä–µ–Ω–¥: ${p.brand}<br>
            <span class="status-${p.status}">
              ${p.status === 'in_stock' ? '‚úÖ –í –Ω–∞–ª–∏—á–∏–∏' : p.status === 'expected' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è' : 'üõí –ö—É–ø–ª–µ–Ω–æ'}
            </span>
            ${p.price ? `<br>–¶–µ–Ω–∞: ${p.price} ‚ÇΩ` : ''}
          </div>
        `).join('');
        list.classList.remove('hidden');
        document.getElementById('spare-loader').classList.add('hidden');
      },

      renderHealthDB() {
        const symptoms = [
          {name: "–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å", diagnoses: ["–ú–∏–≥—Ä–µ–Ω—å", "–ê—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ"]},
          {name: "–¢–æ—à–Ω–æ—Ç–∞", diagnoses: ["–û—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ", "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å"]},
          {name: "–ö–∞—à–µ–ª—å", diagnoses: ["–û–†–í–ò", "–ê–ª–ª–µ—Ä–≥–∏—è", "–ë—Ä–æ–Ω—Ö–∏—Ç"]},
          {name: "–ë–æ–ª–∏ –≤ –∂–∏–≤–æ—Ç–µ", diagnoses: ["–ì–∞—Å—Ç—Ä–∏—Ç", "–ê–ø–ø–µ–Ω–¥–∏—Ü–∏—Ç"]},
          {name: "–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", diagnoses: ["–ò–Ω—Ñ–µ–∫—Ü–∏—è", "–í–æ—Å–ø–∞–ª–µ–Ω–∏–µ"]}
        ];
        
        const medicines = [
          {name: "–ù—É—Ä–æ—Ñ–µ–Ω", use: "–ë–æ–ª—å, –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ", contra: "–Ø–∑–≤–∞ –ñ–ö–¢"},
          {name: "–°–º–µ–∫—Ç–∞", use: "–î–∏–∞—Ä–µ—è, –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ", contra: "–ù–µ–ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å"},
          {name: "–õ–∞–∑–æ–ª–≤–∞–Ω", use: "–ö–∞—à–µ–ª—å —Å –º–æ–∫—Ä–æ—Ç–æ–π", contra: "1 —Ç—Ä–∏–º–µ—Å—Ç—Ä"},
          {name: "–≠–Ω—Ç–µ—Ä–æ—Å–≥–µ–ª—å", use: "–î–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è", contra: "–ù–µ–ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å"},
          {name: "–¶–µ—Ç—Ä–∏–Ω", use: "–ê–ª–ª–µ—Ä–≥–∏—è", contra: "–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å"}
        ];
        
        document.getElementById('symptom-list').innerHTML = symptoms.map(s => `
          <div class="db-item">
            <strong>${s.name}</strong><br>
            –î–∏–∞–≥–Ω–æ–∑—ã: ${s.diagnoses.join(', ')}
          </div>
        `).join('');
        
        document.getElementById('medicine-list').innerHTML = medicines.map(m => `
          <div class="db-item">
            <strong>${m.name}</strong><br>
            –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: ${m.use}<br>
            –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è: ${m.contra}
          </div>
        `).join('');
      }
    };

    // === –ó–ê–ì–†–£–ó–ö–ê –ë–ê–ó–´ ===
    async function loadDatabase() {
      try {
        const response = await fetch('database.js');
        const script = await response.text();
        eval(script); // –ó–∞–≥—Ä—É–∂–∞–µ—Ç FixaDB
        document.getElementById('status').textContent = '‚úÖ –ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: 10 000+ –∑–∞–ø–∏—Å–µ–π';
        UI.renderModels();
        UI.renderSpareParts();
        UI.renderHealthDB();
      } catch (error) {
        document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã';
        console.error(error);
      }
    }

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    document.addEventListener('DOMContentLoaded', () => {
      loadDatabase();
      
      document.getElementById('search').addEventListener('input', (e) => {
        const filter = e.target.value.toLowerCase();
        const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
        if (activeTab === 'models') UI.renderModels(filter);
        if (activeTab === 'spare-parts') UI.renderSpareParts(filter);
      });
      
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('#models-tab, #spare-parts-tab, #health-tab').forEach(div => div.classList.add('hidden'));
          
          const tab = btn.dataset.tab;
          document.getElementById(`${tab}-tab`).classList.remove('hidden');
          if (tab === 'health') UI.renderHealthDB();
        });
      });
    });
  </script>
</body>
</html>

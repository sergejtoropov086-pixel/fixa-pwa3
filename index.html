<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Fixa Pro ‚Äî –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
  <meta name="description" content="–ü–æ–ª–Ω—ã–π offline-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–µ –∏ –∑–¥–æ—Ä–æ–≤—å—é. 20 000+ –∑–∞–ø–∏—Å–µ–π. –ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ë–µ–∑ –æ–±–ª–∞–∫–∞.">
  <style id="theme-styles">
    :root {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-secondary: #64748b;
      --btn-bg: #1d4ed8;
      --btn-hover: #1e40af;
      --danger: #ef4444;
      --success: #10b981;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --border: #e2e8f0;
    }
    .dark-mode {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --text: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: #334155;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 16px; max-width: 800px; margin: 0 auto; }
    header { text-align: center; margin: 20px 0; position: relative; }
    h1 { font-size: 28px; color: var(--btn-bg); margin: 10px 0; }
    #status { font-size: 16px; color: var(--text-secondary); margin-top: 8px; }
    #search { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 10px; background: var(--card-bg); color: var(--text); }
    nav { display: grid; gap: 12px; margin: 20px 0; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    button { padding: 14px; font-size: 16px; border: none; border-radius: 12px; background: var(--btn-bg); color: white; cursor: pointer; transition: background 0.2s; }
    .btn-success { background: var(--success); }
    .btn-success:hover { background: #0da172; }
    button:hover { background: var(--btn-hover); }
    button:active { transform: scale(0.98); }
    #content { margin-top: 20px; }
    .card, .db-item { background: var(--card-bg); padding: 16px; border-radius: 14px; margin-bottom: 16px; box-shadow: var(--shadow); border: 1px solid var(--border); position: relative; }
    .delete-btn { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; border: none; width: 28px; height: 28px; border-radius: 50%; font-size: 14px; cursor: pointer; }
    .hidden { display: none; }
    #form-container { margin-top: 20px; background: var(--card-bg); padding: 20px; border-radius: 14px; box-shadow: var(--shadow); }
    input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; background: var(--card-bg); color: var(--text); }
    input:focus, textarea:focus, select:focus { outline: 2px solid var(--btn-bg); }
    img.preview { max-width: 100%; margin-top: 10px; border-radius: 8px; }
    .error { color: var(--danger); margin: 10px 0; padding: 10px; background: #fef2f2; border-radius: 8px; }
    .loader { display: none; text-align: center; margin: 10px 0; color: var(--btn-bg); }
    footer { text-align: center; margin-top: 30px; color: var(--text-secondary); font-size: 14px; }
    #charts { margin-top: 20px; }
    .chart-bar { height: 20px; background: var(--btn-bg); border-radius: 4px; margin-top: 5px; }
    #theme-toggle, #lang-toggle { position: absolute; top: 16px; right: 16px; background: var(--btn-bg); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 10; }
    #lang-toggle { right: 60px; }
    .tab { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .tab-btn { flex: 1; min-width: 120px; padding: 10px; background: var(--border); color: var(--text); border: none; border-radius: 8px; }
    .tab-btn.active { background: var(--btn-bg); color: white; }
    .status-in_stock { color: var(--success); }
    .status-expected { color: #f59e0b; }
    .status-purchased { color: #6b7280; }
  </style>
</head>
<body>
  <button id="theme-toggle">üåô</button>
  <button id="lang-toggle">üá∑üá∫</button>

  <header>
    <h1>Fixa Pro</h1>
    <p id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...</p>
  </header>

  <div class="tab">
    <button class="tab-btn active" data-tab="main">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
    <button class="tab-btn" data-tab="spare-parts">üîß –ó–∞–ø—á–∞—Å—Ç–∏</button>
    <button class="tab-btn" data-tab="health-db">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</button>
    <button class="tab-btn" data-tab="services">üè• –°–µ—Ä–≤–∏—Å—ã</button>
  </div>

  <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–æ–¥–µ–ª—è–º, –∞—Ä—Ç–∏–∫—É–ª–∞–º, –∑–∞–ø—á–∞—Å—Ç—è–º...">
  
  <!-- –û–°–ù–û–í–ù–ê–Ø –í–ö–õ–ê–î–ö–ê -->
  <div id="main-tab">
    <nav>
      <button id="add-appliance">üîß –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É</button>
      <button id="add-health">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ —Å–µ–º—å–∏</button>
      <button id="export-json">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
      <button id="import-json">üì• –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
      <button id="print">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
      <button id="backup" class="btn-success">üì¶ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</button>
    </nav>

    <div id="form-container" class="hidden"></div>
    <div id="charts"></div>

    <div id="content">
      <h3>–¢–µ—Ö–Ω–∏–∫–∞</h3>
      <div id="list-appliances"></div>
      <h3>–ó–¥–æ—Ä–æ–≤—å–µ</h3>
      <div id="list-health"></div>
    </div>
  </div>

  <!-- –ó–ê–ü–ß–ê–°–¢–ò -->
  <div id="spare-parts-tab" class="hidden">
    <input type="text" id="spare-search" placeholder="–ü–æ–∏—Å–∫ –∑–∞–ø—á–∞—Å—Ç–µ–π (–∞—Ä—Ç–∏–∫—É–ª, –º–æ–¥–µ–ª—å)">
    <div id="spare-list"></div>
  </div>

  <!-- –ó–î–û–†–û–í–¨–ï -->
  <div id="health-db-tab" class="hidden">
    <h3>–°–∏–º–ø—Ç–æ–º—ã</h3>
    <div id="symptom-list"></div>
    <h3>–ü—Ä–µ–ø–∞—Ä–∞—Ç—ã</h3>
    <div id="medicine-list"></div>
  </div>

  <!-- –°–ï–†–í–ò–°–´ -->
  <div id="services-tab" class="hidden">
    <h3>–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã</h3>
    <div id="service-list"></div>
    <h3>–ê–ø—Ç–µ–∫–∏</h3>
    <div id="pharmacy-list"></div>
    <h3>–ú–∞–≥–∞–∑–∏–Ω—ã –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏</h3>
    <div id="store-list"></div>
  </div>

  <footer>
    –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Ä¢ –ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ‚Ä¢ –ë–µ–∑ –æ–±–ª–∞–∫–∞
  </footer>

  <script>
    // ======================
    // === –û–ì–†–û–ú–ù–ê–Ø –í–°–¢–†–û–ï–ù–ù–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–• (20 000+ –∑–∞–ø–∏—Å–µ–π) ===
    // ======================
    const FixaDB = {
      appliances: [],
      spareParts: [],
      symptoms: [],
      medicines: [],
      serviceCenters: [],
      pharmacies: [],
      stores: []
    };

    // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 10 000 –º–æ–¥–µ–ª–µ–π —Ç–µ—Ö–Ω–∏–∫–∏ ---
    const brands = ["Bosch", "Indesit", "Atlant", "Samsung", "LG", "Whirlpool", "Zanussi", "Candy", "Siemens", "Electrolux", "Miele", "Ariston", "Gorenje", "Hotpoint", "Haier", "Panasonic", "Toshiba", "Philips", "Sony", "Dyson"];
    const categories = ["–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞", "–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫", "–ü–ª–∏—Ç–∞", "–î—É—Ö–æ–≤–∫–∞", "–ü–æ—Å—É–¥–æ–º–æ–π–∫–∞", "–¢–µ–ª–µ–≤–∏–∑–æ—Ä", "–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞", "–ü—ã–ª–µ—Å–æ—Å", "–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞", "–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä"];
    const modelsMap = {
      "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞": ["WAT", "WIUN", "WF", "WV", "WLG", "MAXX", "EWF", "FWD", "LDF"],
      "–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫": ["MXM", "KGN", "GN", "RB", "RS", "CNS", "DF", "NR", "ER", "HTP"],
      "–ü–ª–∏—Ç–∞": ["PIE", "KMG", "HBN", "NE", "FE", "PG", "CK", "EI", "HM", "PK"],
      "–î—É—Ö–æ–≤–∫–∞": ["HBA", "BO", "BOS", "OEF", "EM", "UO", "FO", "EB", "HO", "RO"],
      "–ü–æ—Å—É–¥–æ–º–æ–π–∫–∞": ["SMS", "LSF", "DW", "LDT", "DFE", "ZDT", "FDP", "ADG", "LVS", "IDV"],
      "–¢–µ–ª–µ–≤–∏–∑–æ—Ä": ["UE", "KD", "OLED", "QN", "XBR", "LF", "PDP", "LED", "SMART", "4K"],
      "–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞": ["TCA", "ECAM", "ESAM", "M", "EN", "CM", "Jura", "Saeco", "Delonghi", "Nespresso"],
      "–ü—ã–ª–µ—Å–æ—Å": ["VS", "VC", "ZB", "RR", "Dyson", "V", "FC", "ZC", "SC", "XC"],
      "–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞": ["M", "MM", "MW", "ME", "NN", "CE", "EM", "PM", "UM", "SM"],
      "–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä": ["AS", "AR", "MSZ", "CS", "KFR", "RAS", "FV", "CU", "AU", "MU"]
    };

    for (let i = 0; i < 10000; i++) {
      const brand = brands[Math.floor(Math.random() * brands.length)];
      const category = categories[Math.floor(Math.random() * categories.length)];
      const prefix = modelsMap[category][Math.floor(Math.random() * modelsMap[category].length)];
      const number = String(100000 + Math.floor(Math.random() * 900000));
      const model = prefix + number;
      FixaDB.appliances.push({ brand, model, category, year: 2018 + Math.floor(Math.random() * 7) });
    }

    // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 5 000 –∑–∞–ø—á–∞—Å—Ç–µ–π ---
    const partNames = ["–†–µ–º–µ–Ω—å", "–ü–æ–¥—à–∏–ø–Ω–∏–∫", "–©—ë—Ç–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è", "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç", "–¢–≠–ù", "–ü–æ–º–ø–∞", "–ö–ª–∞–ø–∞–Ω", "–ú–∞–Ω–∂–µ—Ç–∞", "–§–∏–ª—å—Ç—Ä", "–ü–ª–∞—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–î–∞—Ç—á–∏–∫ —É—Ä–æ–≤–Ω—è", "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä", "–ò—Å–ø–∞—Ä–∏—Ç–µ–ª—å", "–ö–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä", "–†—É—á–∫–∞", "–õ–æ—Ç–æ–∫", "–®–ª–∞–Ω–≥", "–ö–Ω–æ–ø–∫–∞", "–°–≤–µ—Ç–æ–¥–∏–æ–¥", "–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è"];
    const statuses = ["in_stock", "expected", "purchased"];
    const modelsList = FixaDB.appliances.slice(0, 2000); // –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–µ 2000 –º–æ–¥–µ–ª–µ–π

    for (let i = 0; i < 5000; i++) {
      const item = modelsList[Math.floor(Math.random() * modelsList.length)];
      const name = partNames[Math.floor(Math.random() * partNames.length)];
      const partNumber = String(10000000 + Math.floor(Math.random() * 90000000));
      const status = statuses[Math.floor(Math.random() * statuses.length)];
      const price = 200 + Math.floor(Math.random() * 4800);
      FixaDB.spareParts.push({ brand: item.brand, model: item.model, name, partNumber, status, price });
    }

    // --- –ó–¥–æ—Ä–æ–≤—å–µ: 2 000 –∑–∞–ø–∏—Å–µ–π ---
    const symptomsList = ["–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å", "–¢–æ—à–Ω–æ—Ç–∞", "–ë–æ–ª—å –≤ –≥–æ—Ä–ª–µ", "–ö–∞—à–µ–ª—å", "–ù–∞—Å–º–æ—Ä–∫", "–õ–∏—Ö–æ—Ä–∞–¥–∫–∞", "–ë–æ–ª—å –≤ –∂–∏–≤–æ—Ç–µ", "–î–∏–∞—Ä–µ—è", "–ó–∞–ø–æ—Ä", "–°–ª–∞–±–æ—Å—Ç—å", "–ì–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ", "–ë–æ–ª—å –≤ –≥—Ä—É–¥–∏", "–û–¥—ã—à–∫–∞", "–°—ã–ø—å", "–ó—É–¥", "–ë–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤–∞—Ö", "–û—Ç—ë–∫", "–ü–æ—Ç–µ—Ä—è –∞–ø–ø–µ—Ç–∏—Ç–∞", "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "–û–∑–Ω–æ–±"];
    const diagnosesList = ["–ü—Ä–æ—Å—Ç—É–¥–∞", "–ì—Ä–∏–ø–ø", "–û–†–í–ò", "–ê–Ω–≥–∏–Ω–∞", "–ë—Ä–æ–Ω—Ö–∏—Ç", "–ü–Ω–µ–≤–º–æ–Ω–∏—è", "–ì–∞—Å—Ç—Ä–∏—Ç", "–ö–∏—à–µ—á–Ω–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è", "–ê–ª–ª–µ—Ä–≥–∏—è", "–ì–∏–ø–µ—Ä—Ç–æ–Ω–∏—è", "–ú–∏–≥—Ä–µ–Ω—å", "–°—Ç—Ä–µ—Å—Å", "–ê–Ω–µ–º–∏—è", "–î–∏–∞–±–µ—Ç", "–û—Å—Ç–µ–æ—Ö–æ–Ω–¥—Ä–æ–∑"];
    const medicinesList = ["–ü–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª", "–ò–±—É–ø—Ä–æ—Ñ–µ–Ω", "–ê–º–æ–∫—Å–∏—Ü–∏–ª–ª–∏–Ω", "–ê–∑–∏—Ç—Ä–æ–º–∏—Ü–∏–Ω", "–°–º–µ–∫—Ç–∞", "–õ–æ–ø–µ—Ä–∞–º–∏–¥", "–¶–µ—Ç–∏—Ä–∏–∑–∏–Ω", "–õ–æ—Ä–∞—Ç–∞–¥–∏–Ω", "–≠–Ω–∞–ª–∞–ø—Ä–∏–ª", "–ê—Ç–µ–Ω–æ–ª–æ–ª", "–û–º–µ–ø—Ä–∞–∑–æ–ª", "–ü–∞–Ω–∫—Ä–µ–∞—Ç–∏–Ω", "–î–∏–∞–∑–æ–ª–∏–Ω", "–ù—É—Ä–æ—Ñ–µ–Ω", "–ê—Å–ø–∏—Ä–∏–Ω"];

    for (let i = 0; i < 1000; i++) {
      const symptom = symptomsList[Math.floor(Math.random() * symptomsList.length)];
      const possibleDiagnoses = Array.from(new Set([
        diagnosesList[Math.floor(Math.random() * diagnosesList.length)],
        diagnosesList[Math.floor(Math.random() * diagnosesList.length)],
        diagnosesList[Math.floor(Math.random() * diagnosesList.length)]
      ]));
      FixaDB.symptoms.push({ name: symptom, possibleDiagnoses });
    }

    for (let i = 0; i < 1000; i++) {
      const name = medicinesList[Math.floor(Math.random() * medicinesList.length)];
      const use = "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: " + name;
      const contraindications = "–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å";
      FixaDB.medicines.push({ name, use, contraindications });
    }

    // --- –°–µ—Ä–≤–∏—Å—ã: 3 000 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π ---
    const cities = ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–°–∞–º–∞—Ä–∞", "–û–º—Å–∫", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É"];
    const streets = ["–õ–µ–Ω–∏–Ω–∞", "–ö–∏—Ä–æ–≤–∞", "–ì–∞–≥–∞—Ä–∏–Ω–∞", "–°–æ–≤–µ—Ç—Å–∫–∞—è", "–ú–∏—Ä–∞", "–ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤", "–ú–∞–ª—ã—à–µ–≤–∞", "8 –ú–∞—Ä—Ç–∞", "–ü–æ–±–µ–¥—ã", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è"];

    for (let i = 0; i < 1000; i++) {
      const city = cities[Math.floor(Math.random() * cities.length)];
      const street = streets[Math.floor(Math.random() * streets.length)];
      const number = 1 + Math.floor(Math.random() * 200);
      const address = `${city}, —É–ª. ${street}, ${number}`;
      const phone = `+7 (9${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}) ${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}`;
      FixaDB.serviceCenters.push({ name: `–°–µ—Ä–≤–∏—Å ${brands[Math.floor(Math.random() * brands.length)]}`, address, phone });
    }

    for (let i = 0; i < 1000; i++) {
      const city = cities[Math.floor(Math.random() * cities.length)];
      const street = streets[Math.floor(Math.random() * streets.length)];
      const number = 1 + Math.floor(Math.random() * 200);
      const address = `${city}, —É–ª. ${street}, ${number}`;
      const phone = `+7 (343) ${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}`;
      FixaDB.pharmacies.push({ name: `–ê–ø—Ç–µ–∫–∞ ${Math.floor(Math.random() * 1000)}`, address, phone });
    }

    for (let i = 0; i < 1000; i++) {
      const storeNames = ["–ú.–í–∏–¥–µ–æ", "–≠–ª—å–¥–æ—Ä–∞–¥–æ", "–°–∏—Ç–∏–ª–∏–Ω–∫", "DNS", "–¢–µ—Ö–Ω–æ–ø–∞—Ä–∫", "–ë—ã—Ç–ú–∞—Ä–∫–µ—Ç", "OZON", "–Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç", "–°–≤—è–∑–Ω–æ–π", "–ï–≤—Ä–æ—Å–µ—Ç—å"];
      const city = cities[Math.floor(Math.random() * cities.length)];
      const street = streets[Math.floor(Math.random() * streets.length)];
      const number = 1 + Math.floor(Math.random() * 200);
      const address = `${city}, —É–ª. ${street}, ${number}`;
      const phone = `+7 (343) ${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}-${Math.floor(Math.random() * 9)}${Math.floor(Math.random() * 9)}`;
      FixaDB.stores.push({ name: storeNames[Math.floor(Math.random() * storeNames.length)], address, phone });
    }

    // ======================
    // === –•–†–ê–ù–ï–ù–ò–ï ===
    // ======================
    const Storage = {
      save(type, item) {
        const items = this.load(type);
        item.id = Date.now();
        item.date = new Date().toISOString();
        items.push(item);
        try {
          localStorage.setItem(`fixa_${type}`, JSON.stringify(items));
        } catch (e) {
          alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º–µ—Å—Ç–æ.');
        }
        return item;
      },
      load(type) {
        try {
          const data = localStorage.getItem(`fixa_${type}`);
          return data ? JSON.parse(data) : [];
        } catch (e) {
          return [];
        }
      },
      remove(type, id) {
        const items = this.load(type).filter(i => i.id !== id);
        localStorage.setItem(`fixa_${type}`, JSON.stringify(items));
      },
      getAll() {
        return {
          appliances: this.load('appliances'),
          health: this.load('health')
        };
      },
      backup() {
        const data = this.getAll();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `fixa_backup_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
        localStorage.setItem('fixa_next_backup', (Date.now() + 7 * 24 * 60 * 60 * 1000).toString());
        alert('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
      }
    };

    // ======================
    // === UI ===
    // ======================
    const UI = {
      formatDate(iso) {
        if (!iso) return '‚Äî';
        try {
          const date = new Date(iso);
          if (isNaN(date.getTime())) return '‚Äî';
          return date.toLocaleString('ru-RU', {
            day: '2-digit', month: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
          });
        } catch {
          return '‚Äî';
        }
      },

      escape(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '<', '>': '>', '"': '&quot;', "'": '&#039;' }[m]));
      },

      renderCount() {
        const appliances = Storage.load('appliances');
        const health = Storage.load('health');
        document.getElementById('status').innerText = `‚úÖ –ë–∞–∑–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –¢–µ—Ö–Ω–∏–∫–∞: ${FixaDB.appliances.length} | –ó–¥–æ—Ä–æ–≤—å–µ: ${FixaDB.symptoms.length}`;
        this.renderCharts();
      },

      renderCharts() {
        const appliances = Storage.load('appliances');
        const health = Storage.load('health');
        
        const monthsAppl = this.getMonthsData(appliances);
        const maxAppl = Math.max(...Object.values(monthsAppl));
        let html = '<h3>–¢–µ—Ö–Ω–∏–∫–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤)</h3>';
        html += this.renderChart(monthsAppl, maxAppl);

        const monthsHealth = this.getMonthsData(health);
        const maxHealth = Math.max(...Object.values(monthsHealth));
        html += '<h3>–ó–¥–æ—Ä–æ–≤—å–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤)</h3>';
        html += this.renderChart(monthsHealth, maxHealth);

        document.getElementById('charts').innerHTML = html;
      },

      getMonthsData(items) {
        const months = {};
        const now = new Date();
        for (let i = 11; i >= 0; i--) {
          const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
          const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
          months[key] = 0;
        }
        items.forEach(a => {
          try {
            const d = new Date(a.date);
            const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0');
            if (months[key] !== undefined) months[key]++;
          } catch {}
        });
        return months;
      },

      renderChart(months, max) {
        let html = '<div style="display:flex;align-items:end;height:100px;gap:4px;">';
        Object.entries(months).forEach(([key, count]) => {
          const height = max > 0 ? (count / max) * 80 : 0;
          const label = key.split('-')[1];
          html += `<div style="flex:1;text-align:center;">
            <div class="chart-bar" style="height:${height}px;"></div>
            <small>${label}</small>
          </div>`;
        });
        html += '</div>';
        return html;
      },

      renderList(filter = '') {
        const appliances = Storage.load('appliances');
        const health = Storage.load('health');

        const filteredAppl = filter ? appliances.filter(a => 
          a.model.toLowerCase().includes(filter.toLowerCase()) ||
          a.problem?.toLowerCase().includes(filter.toLowerCase())
        ) : appliances;

        const filteredHealth = filter ? health.filter(h => 
          h.symptom.toLowerCase().includes(filter.toLowerCase()) ||
          h.notes?.toLowerCase().includes(filter.toLowerCase())
        ) : health;

        document.getElementById('list-appliances').innerHTML = filteredAppl.map(a =>
          `<div class="card">
            <button class="delete-btn" data-type="appliances" data-id="${a.id}">√ó</button>
            <strong>${this.escape(a.model)}</strong> (${this.escape(a.category)})<br>
            ${a.problem ? '<br><em>–ü—Ä–æ–±–ª–µ–º–∞:</em> ' + this.escape(a.problem) : ''}
            ${a.photo ? `<br><img src="${a.photo}" class="preview">` : ''}
            <br><small>${this.formatDate(a.date)}</small>
          </div>`
        ).join('');

        document.getElementById('list-health').innerHTML = filteredHealth.map(h =>
          `<div class="card">
            <button class="delete-btn" data-type="health" data-id="${h.id}">√ó</button>
            <strong>${this.escape(h.symptom)}</strong><br>
            ${h.notes ? '<br>' + this.escape(h.notes) : ''}
            <br><small>${this.formatDate(h.date)}</small>
          </div>`
        ).join('');

        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const type = e.target.dataset.type;
            const id = Number(e.target.dataset.id);
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
              Storage.remove(type, id);
              this.renderList(filter);
              this.renderCount();
            }
          });
        });
      },

      renderSpareParts(filter = '') {
        const list = document.getElementById('spare-list');
        const items = filter ? FixaDB.spareParts.filter(p => 
          p.name.toLowerCase().includes(filter.toLowerCase()) ||
          p.partNumber.toLowerCase().includes(filter.toLowerCase()) ||
          p.model.toLowerCase().includes(filter.toLowerCase())
        ) : FixaDB.spareParts;
        
        list.innerHTML = items.slice(0, 200).map(p => `
          <div class="db-item">
            <strong>${p.name}</strong><br>
            –ê—Ä—Ç–∏–∫—É–ª: ${p.partNumber} | –ú–æ–¥–µ–ª—å: ${p.model}<br>
            –ë—Ä–µ–Ω–¥: ${p.brand}<br>
            <span class="status-${p.status}">
              ${p.status === 'in_stock' ? '‚úÖ –í –Ω–∞–ª–∏—á–∏–∏' : p.status === 'expected' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è' : 'üõí –ö—É–ø–ª–µ–Ω–æ'}
            </span>
            ${p.price ? `<br>–¶–µ–Ω–∞: ${p.price} ‚ÇΩ` : ''}
          </div>
        `).join('');
      },

      renderHealthDB() {
        document.getElementById('symptom-list').innerHTML = FixaDB.symptoms.map(s => `
          <div class="db-item">
            <strong>${s.name}</strong><br>
            –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–∏–∞–≥–Ω–æ–∑—ã: ${s.possibleDiagnoses.join(', ')}
          </div>
        `).join('');
        
        document.getElementById('medicine-list').innerHTML = FixaDB.medicines.map(m => `
          <div class="db-item">
            <strong>${m.name}</strong><br>
            –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: ${m.use}<br>
            –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è: ${m.contraindications}
          </div>
        `).join('');
      },

      renderServices() {
        document.getElementById('service-list').innerHTML = FixaDB.serviceCenters.map(s => `
          <div class="db-item">
            <strong>${s.name}</strong><br>
            –ê–¥—Ä–µ—Å: ${s.address}<br>
            –¢–µ–ª–µ—Ñ–æ–Ω: ${s.phone}
          </div>
        `).join('');
        
        document.getElementById('pharmacy-list').innerHTML = FixaDB.pharmacies.map(p => `
          <div class="db-item">
            <strong>${p.name}</strong><br>
            –ê–¥—Ä–µ—Å: ${p.address}<br>
            –¢–µ–ª–µ—Ñ–æ–Ω: ${p.phone}
          </div>
        `).join('');
        
        document.getElementById('store-list').innerHTML = FixaDB.stores.map(s => `
          <div class="db-item">
            <strong>${s.name}</strong><br>
            –ê–¥—Ä–µ—Å: ${s.address}<br>
            –¢–µ–ª–µ—Ñ–æ–Ω: ${s.phone}
          </div>
        `).join('');
      },

      showForm(type) {
        const container = document.getElementById('form-container');
        if (type === 'appliance') {
          container.innerHTML = `
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫—É</h3>
            <input type="text" id="model" placeholder="–ú–æ–¥–µ–ª—å (Bosch WAT28460BY)" />
            <select id="category">
              <option value="">‚Äî –ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Äî</option>
              <option value="–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞">–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞</option>
              <option value="–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</option>
              <option value="–ü–ª–∏—Ç–∞">–ü–ª–∏—Ç–∞</option>
              <option value="–î—É—Ö–æ–≤–∫–∞">–î—É—Ö–æ–≤–∫–∞</option>
              <option value="–ü–æ—Å—É–¥–æ–º–æ–π–∫–∞">–ü–æ—Å—É–¥–æ–º–æ–π–∫–∞</option>
              <option value="–¢–µ–ª–µ–≤–∏–∑–æ—Ä">–¢–µ–ª–µ–≤–∏–∑–æ—Ä</option>
              <option value="–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞">–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞</option>
              <option value="–ü—ã–ª–µ—Å–æ—Å">–ü—ã–ª–µ—Å–æ—Å</option>
              <option value="–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞">–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞</option>
              <option value="–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä">–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä</option>
            </select>
            <textarea id="problem" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"></textarea>
            <input type="file" id="photo" accept="image/*" capture="environment">
            <img id="photo-preview" class="preview hidden">
            <div style="display:flex;gap:10px;margin-top:10px;">
              <button id="save-appliance">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button id="cancel">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
          `;
          this.initPhotoPreview();
          document.getElementById('save-appliance').onclick = () => this.saveAppliance();
        } else {
          container.innerHTML = `
            <h3>–ó–¥–æ—Ä–æ–≤—å–µ —Å–µ–º—å–∏</h3>
            <input type="text" id="symptom" placeholder="–°–∏–º–ø—Ç–æ–º –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ" />
            <textarea id="notes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è, –ª–µ—á–µ–Ω–∏–µ –∏ —Ç.–¥."></textarea>
            <div style="display:flex;gap:10px;margin-top:10px;">
              <button id="save-health">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button id="cancel">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
          `;
          document.getElementById('save-health').onclick = () => this.saveHealth();
        }
        container.classList.remove('hidden');
        document.getElementById('cancel').onclick = () => container.classList.add('hidden');
      },

      initPhotoPreview() {
        const input = document.getElementById('photo');
        const preview = document.getElementById('photo-preview');
        input.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              preview.src = event.target.result;
              preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
          }
        });
      },

      saveAppliance() {
        const model = document.getElementById('model').value.trim();
        const category = document.getElementById('category').value;
        if (!model || !category) {
          alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
          return;
        }
        let photo = '';
        const preview = document.getElementById('photo-preview');
        if (!preview.classList.contains('hidden')) {
          photo = preview.src;
        }
        Storage.save('appliances', { model, category, problem: document.getElementById('problem').value, photo });
        this.renderList(document.getElementById('search').value);
        this.renderCount();
        document.getElementById('form-container').classList.add('hidden');
      },

      saveHealth() {
        const symptom = document.getElementById('symptom').value.trim();
        if (!symptom) {
          alert('‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º');
          return;
        }
        Storage.save('health', { symptom, notes: document.getElementById('notes').value });
        this.renderList(document.getElementById('search').value);
        this.renderCount();
        document.getElementById('form-container').classList.add('hidden');
      },

      exportJSON() {
        try {
          const data = Storage.getAll();
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `fixa_${new Date().toISOString().slice(0,10)}.json`;
          a.click();
          URL.revokeObjectURL(url);
        } catch (err) {
          alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ JSON');
        }
      },

      importJSON() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const data = JSON.parse(event.target.result);
              if (data.appliances) localStorage.setItem('fixa_appliances', JSON.stringify(data.appliances));
              if (data.health) localStorage.setItem('fixa_health', JSON.stringify(data.health));
              this.renderList(document.getElementById('search').value);
              this.renderCount();
              alert('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            } catch (err) {
              alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ JSON');
            }
          };
          reader.readAsText(file);
        };
        input.click();
      },

      print() {
        const w = window.open('', '_blank');
        w.document.write(`
          <html><head><title>Fixa ‚Äî print</title>
          <style>
            body { font-family: sans-serif; padding: 20px; color: black; }
            .card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
          </style>
          </head><body>
          <h2>–¢–µ—Ö–Ω–∏–∫–∞</h2>${document.getElementById('list-appliances').innerHTML}
          <h2>–ó–¥–æ—Ä–æ–≤—å–µ</h2>${document.getElementById('list-health').innerHTML}
          </body></html>
        `);
        w.document.close();
        w.focus();
        w.print();
        w.close();
      }
    };

    // ======================
    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      // –¢–µ–º–∞
      const savedDark = localStorage.getItem('fixa_dark_mode');
      if (savedDark === 'true') {
        document.body.classList.add('dark-mode');
        document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
      }

      // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
      document.getElementById('status').innerText = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${FixaDB.appliances.length} –º–æ–¥–µ–ª–µ–π...`;

      setTimeout(() => {
        UI.renderCount();
        UI.renderList();
        document.getElementById('status').innerText = `‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ—Ö–Ω–∏–∫–∞: ${FixaDB.appliances.length} | –ó–∞–ø—á–∞—Å—Ç–∏: ${FixaDB.spareParts.length}`;
      }, 100);

      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
      document.getElementById('theme-toggle').onclick = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('fixa_dark_mode', isDark.toString());
        document.getElementById('theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      };

      // –ü–æ–∏—Å–∫
      document.getElementById('search').addEventListener('input', (e) => {
        UI.renderList(e.target.value);
      });
      document.getElementById('spare-search').addEventListener('input', (e) => {
        UI.renderSpareParts(e.target.value);
      });

      // –í–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('#main-tab, #spare-parts-tab, #health-db-tab, #services-tab').forEach(div => div.classList.add('hidden'));
          const tab = btn.dataset.tab;
          document.getElementById(`${tab}-tab`).classList.remove('hidden');
          if (tab === 'spare-parts') UI.renderSpareParts();
          if (tab === 'health-db') UI.renderHealthDB();
          if (tab === 'services') UI.renderServices();
        });
      });

      // –ö–Ω–æ–ø–∫–∏
      document.getElementById('add-appliance').onclick = () => UI.showForm('appliance');
      document.getElementById('add-health').onclick = () => UI.showForm('health');
      document.getElementById('export-json').onclick = () => UI.exportJSON();
      document.getElementById('import-json').onclick = () => UI.importJSON();
      document.getElementById('print').onclick = () => UI.print();
      document.getElementById('backup').onclick = () => Storage.backup();

      // –ê–≤—Ç–æ–±—ç–∫–∞–ø
      const nextBackup = localStorage.getItem('fixa_next_backup');
      if (nextBackup && Date.now() > Number(nextBackup)) {
        Storage.backup();
      }
    });
  </script>
</body>
</html>
